<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Quick Start - dranet</title>
<meta name=generator content="Hugo 0.125.5"><link href=https://google.github.io/dranet//index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://google.github.io/dranet/user/quick-start/><link rel=stylesheet href=https://google.github.io/dranet/css/theme.min.css><link rel=stylesheet href=https://google.github.io/dranet/css/chroma.min.css><script defer src=https://google.github.io/dranet//js/fontawesome6/all.min.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js integrity="sha256-H3cjtrm/ztDeuhCN9I4yh4iN2Ybx/y1RM7rMmAesA0k=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js integrity="sha256-4XodgW4TwIJuDtf+v6vDJ39FVxI0veC/kSCCmnFp7ck=" crossorigin=anonymous></script><script src=https://google.github.io/dranet/js/bundle.js></script><style>:root{}</style><meta property="og:url" content="https://google.github.io/dranet/user/quick-start/"><meta property="og:site_name" content="dranet"><meta property="og:title" content="Quick Start"><meta property="og:description" content='DRANET depends on the Kubernetes feature Dynamic Resource Allocation (DRA), that is beta (disabled by default in v1.32).
In order to enable DRA you need to enable both the feature gates and the API groups.
Create a Kubernetes Cluster KIND Install KIND.
Create a cluster using the following configuration.
kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 containerdConfigPatches: # Enable NRI plugins - |- [plugins."io.containerd.nri.v1.nri"] disable = false nodes: - role: control-plane image: kindest/node:v1.32.0 - role: worker image: kindest/node:v1.'><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="user"><meta property="article:published_time" content="2024-12-17T14:47:05+00:00"><meta property="article:modified_time" content="2024-12-18T12:09:26+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Quick Start"><meta name=twitter:description content='DRANET depends on the Kubernetes feature Dynamic Resource Allocation (DRA), that is beta (disabled by default in v1.32).
In order to enable DRA you need to enable both the feature gates and the API groups.
Create a Kubernetes Cluster KIND Install KIND.
Create a cluster using the following configuration.
kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 containerdConfigPatches: # Enable NRI plugins - |- [plugins."io.containerd.nri.v1.nri"] disable = false nodes: - role: control-plane image: kindest/node:v1.32.0 - role: worker image: kindest/node:v1.'><meta itemprop=name content="Quick Start"><meta itemprop=description content='DRANET depends on the Kubernetes feature Dynamic Resource Allocation (DRA), that is beta (disabled by default in v1.32).
In order to enable DRA you need to enable both the feature gates and the API groups.
Create a Kubernetes Cluster KIND Install KIND.
Create a cluster using the following configuration.
kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 containerdConfigPatches: # Enable NRI plugins - |- [plugins."io.containerd.nri.v1.nri"] disable = false nodes: - role: control-plane image: kindest/node:v1.32.0 - role: worker image: kindest/node:v1.'><meta itemprop=datePublished content="2024-12-17T14:47:05+00:00"><meta itemprop=dateModified content="2024-12-18T12:09:26+00:00"><meta itemprop=wordCount content="813"></head><body><div class=container><header><h1>dranet</h1></header><div class=global-menu><nav><ul><li id=home><a href=/dranet/>Home</a></li><li id=user><a href>User Guide</a></li><li id=design><a href>Design</a></li><li id=contributing><a href>Contributing</a></li></ul></nav></div><div class=content-container><main><h1>Quick Start</h1><p>DRANET depends on the Kubernetes feature <a href=https://kubernetes.io/docs/concepts/scheduling-eviction/dynamic-resource-allocation/>Dynamic Resource Allocation (DRA)</a>, that is beta (disabled by default in v1.32).</p><p>In order to enable DRA you need to enable both the <a href=https://kubernetes.io/docs/concepts/scheduling-eviction/dynamic-resource-allocation/#enabling-dynamic-resource-allocation>feature gates and the API groups</a>.</p><h2 id=create-a-kubernetes-cluster>Create a Kubernetes Cluster</h2><h3 id=kind>KIND</h3><p>Install <a href="https://github.com/kubernetes-sigs/kind?tab=readme-ov-file#installation-and-usage">KIND</a>.</p><p>Create a cluster using the following configuration.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>kind: Cluster
</span></span><span style=display:flex><span>apiVersion: kind.x-k8s.io/v1alpha4
</span></span><span style=display:flex><span>containerdConfigPatches:
</span></span><span style=display:flex><span>  <span style=color:green># Enable NRI plugins</span>
</span></span><span style=display:flex><span>- |-<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>  [plugins.&#34;io.containerd.nri.v1.nri&#34;]
</span></span></span><span style=display:flex><span><span style=color:#a31515>    disable = false</span>  
</span></span><span style=display:flex><span>nodes:
</span></span><span style=display:flex><span>- role: control-plane
</span></span><span style=display:flex><span>  image: kindest/node:v1.32.0
</span></span><span style=display:flex><span>- role: worker
</span></span><span style=display:flex><span>  image: kindest/node:v1.32.0
</span></span><span style=display:flex><span>- role: worker
</span></span><span style=display:flex><span>  image: kindest/node:v1.32.0
</span></span><span style=display:flex><span>featureGates:
</span></span><span style=display:flex><span>  <span style=color:green># Enable the corresponding DRA feature gates</span>
</span></span><span style=display:flex><span>  DynamicResourceAllocation: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>runtimeConfig:
</span></span><span style=display:flex><span>  api/beta : <span style=color:#00f>true</span>
</span></span></code></pre></div><pre tabindex=0><code>kind create cluster --config kind.yaml --name dra
</code></pre><h3 id=google-cloud>Google Cloud</h3><p>You can <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/use-beta-apis>enable the DRA beta APIs in GKE</a> and it automatically turns on the feature gates.</p><p>You need to check that a v1.32 version exist in your zone:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ gcloud container get-server-config  | grep 1.32
</span></span><span style=display:flex><span>Fetching server config <span style=color:#00f>for</span> us-central1-c
</span></span><span style=display:flex><span>  - 1.32.0-gke.1358000
</span></span><span style=display:flex><span>  minorVersion: <span style=color:#a31515>&#39;1.32&#39;</span>
</span></span><span style=display:flex><span>- 1.32.0-gke.1358000
</span></span><span style=display:flex><span>- 1.32.0-gke.1358000
</span></span></code></pre></div><p>And using the version obtained you can create a cluster</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export PROJECT=dra-proj
</span></span><span style=display:flex><span>export REGION=us-central1
</span></span><span style=display:flex><span>export ZONE=us-central1-c
</span></span><span style=display:flex><span>export CLUSTER=dra-cluster
</span></span><span style=display:flex><span>export VERSION=1.32.0-gke.1358000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud beta container clusters create <span style=color:#a31515>${</span>CLUSTER<span style=color:#a31515>}</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --cluster-version=<span style=color:#a31515>${</span>VERSION<span style=color:#a31515>}</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --enable-multi-networking <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --enable-dataplane-v2 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --enable-kubernetes-unstable-apis=resource.k8s.io/v1beta1/deviceclasses,resource.k8s.io/v1beta1/resourceclaims,resource.k8s.io/v1beta1/resourceclaimtemplates,resource.k8s.io/v1beta1/resourceslices <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --no-enable-autorepair <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --no-enable-autoupgrade <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --zone=<span style=color:#a31515>${</span>ZONE<span style=color:#a31515>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To inspect the contents of your cluster, go to: https://console.cloud.google.com/kubernetes/workload_/gcloud/us-central1-c/aojea-dra?project=aojea-gke-dev
</span></span><span style=display:flex><span>kubeconfig entry generated <span style=color:#00f>for</span> aojea-dra.
</span></span><span style=display:flex><span>NAME       LOCATION       MASTER_VERSION      MASTER_IP     MACHINE_TYPE  NODE_VERSION        NUM_NODES  STATUS
</span></span><span style=display:flex><span>aojea-dra  us-central1-c  1.32.0-gke.1358000  X.X.X.X  e2-medium     1.32.0-gke.1358000  3          RUNNING
</span></span></code></pre></div><p>A quick and easy way to find if DRA is enabled is by checking the metrics in the kube-apiserver</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get --raw /metrics | grep kubernetes_feature_enabled | grep DynamicResourceAllocation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubernetes_feature_enabled{name=<span style=color:#a31515>&#34;DynamicResourceAllocation&#34;</span>,stage=<span style=color:#a31515>&#34;BETA&#34;</span>} 1
</span></span></code></pre></div><h2 id=install-dranet>Install DRANET</h2><p>You can install the latest stable version using the provided manifest:</p><pre tabindex=0><code>kubectl apply -f https://raw.githubusercontent.com/google/dranet/refs/heads/main/install.yaml
</code></pre><h2 id=how-to-use-it>How to use it</h2><p>Once the Kubernetes Network Driver is running you can see the list of Network Interfaces and its attributes published by the drivers:</p><pre tabindex=0><code>apiVersion: resource.k8s.io/v1beta1
kind: ResourceSlice
metadata:
  creationTimestamp: &#34;2024-12-15T23:41:51Z&#34;
  generateName: gke-aojea-dra-multi-nic-985b8c20-jg5l-dranet.gke.io-
  generation: 1
  name: gke-aojea-dra-multi-nic-985b8c20-jg5l-dranet.gke.io-8nq9c
  ownerReferences:
  - apiVersion: v1
    controller: true
    kind: Node
    name: gke-aojea-dra-multi-nic-985b8c20-jg5l
    uid: 0146a07e-df67-401d-b3a5-dddb02f50b6e
  resourceVersion: &#34;1471803&#34;
  uid: 535724d7-a573-49e1-8f3b-4e644405375a
spec:
  devices:
  - basic:
      attributes:
        alias:
          string: &#34;&#34;
        cloud_network:
          string: projects/961828715260/networks/aojea-dra-net-1
        encapsulation:
          string: ether
        ip:
          string: 192.168.1.2
        kind:
          string: network
        mac:
          string: 42:01:c0:a8:01:02
        mtu:
          int: 8244
        name:
          string: eth1
        numa_node:
          int: -1
        pci_address_bus:
          string: &#34;00&#34;
        pci_address_device:
          string: &#34;05&#34;
        pci_address_domain:
          string: &#34;0000&#34;
        pci_address_function:
          string: &#34;0&#34;
        pci_vendor:
          string: Google, Inc.
        rdma:
          bool: false
        sriov:
          bool: false
        state:
          string: up
        type:
          string: device
        virtual:
          bool: false
    name: eth1
  - basic:
      attributes:
        alias:
          string: &#34;&#34;
        cloud_network:
          string: projects/961828715260/networks/aojea-dra-net-2
        encapsulation:
          string: ether
        ip:
          string: 192.168.2.2
        kind:
          string: network
        mac:
          string: 42:01:c0:a8:02:02
        mtu:
          int: 8244
        name:
          string: eth2
        numa_node:
          int: -1
        pci_address_bus:
          string: &#34;00&#34;
        pci_address_device:
          string: &#34;06&#34;
        pci_address_domain:
          string: &#34;0000&#34;
        pci_address_function:
          string: &#34;0&#34;
        pci_vendor:
          string: Google, Inc.
        rdma:
          bool: false
        sriov:
          bool: false
        state:
          string: up
        type:
          string: device
        virtual:
          bool: false
    name: eth2
  - basic:
      attributes:
        alias:
          string: &#34;&#34;
        cloud_network:
          string: projects/961828715260/networks/aojea-dra-net-3
        encapsulation:
          string: ether
        ip:
          string: 192.168.3.2
        kind:
          string: network
        mac:
          string: 42:01:c0:a8:03:02
        mtu:
          int: 8244
        name:
          string: eth3
        numa_node:
          int: -1
        pci_address_bus:
          string: &#34;00&#34;
        pci_address_device:
          string: &#34;07&#34;
        pci_address_domain:
          string: &#34;0000&#34;
        pci_address_function:
          string: &#34;0&#34;
        pci_vendor:
          string: Google, Inc.
        rdma:
          bool: false
        sriov:
          bool: false
        state:
          string: up
        type:
          string: device
        virtual:
          bool: false
    name: eth3
...
</code></pre><p>Once the resources are available, users can create DeviceClasses, ResourceClaims and/or ResourceClaimTemplates to schedule pods, see some <a href=https://github.com/google/dranet/tree/main/examples>examples</a>.</p><p>Define a <code>DeviceClass</code> that selects all the network interfaces that are connected to a <code>GCP Network</code></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: resource.k8s.io/v1beta1
</span></span><span style=display:flex><span>kind: DeviceClass
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: dranet-cloud
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  selectors:
</span></span><span style=display:flex><span>    - cel:
</span></span><span style=display:flex><span>        expression: device.driver == &#34;dranet.gke.io&#34;
</span></span><span style=display:flex><span>    - cel:
</span></span><span style=display:flex><span>        expression: has(device.attributes[&#34;dranet.gke.io&#34;].cloud_network) 
</span></span><span style=display:flex><span>  config:
</span></span><span style=display:flex><span>  - opaque:
</span></span><span style=display:flex><span>      driver: dranet.gke.io
</span></span><span style=display:flex><span>      parameters:
</span></span><span style=display:flex><span>        nccl: <span style=color:#a31515>&#34;true&#34;</span>
</span></span></code></pre></div><p>Now you can create a <code>ResourceClaim</code> that connects to a specific network, in this case <code>projects/961828715260/networks/aojea-dra-net-3</code> and reference that claim in a <code>Pod</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: resource.k8s.io/v1beta1
</span></span><span style=display:flex><span>kind:  ResourceClaim
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: cloud-network-dra-net-3
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  devices:
</span></span><span style=display:flex><span>    requests:
</span></span><span style=display:flex><span>    - name: req-cloud-net-3
</span></span><span style=display:flex><span>      deviceClassName: dranet-cloud
</span></span><span style=display:flex><span>      selectors:
</span></span><span style=display:flex><span>        - cel:
</span></span><span style=display:flex><span>            expression: device.attributes[&#34;dranet.gke.io&#34;].cloud_network == &#34;projects/961828715260/networks/aojea-dra-net-3&#34;
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Pod
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: pod-dra-net3
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    app: pod-dra-net3
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  containers:
</span></span><span style=display:flex><span>  - name: ctr1
</span></span><span style=display:flex><span>    image: registry.k8s.io/e2e-test-images/agnhost:2.39
</span></span><span style=display:flex><span>  resourceClaims:
</span></span><span style=display:flex><span>  - name: net-3
</span></span><span style=display:flex><span>    resourceClaimName: cloud-network-dra-net-3
</span></span></code></pre></div><p>Kubernets schedules the <code>Pod</code> to the corresponding <code>Node</code> and attach the network interface to the <code>Pod</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods -o wide
</span></span><span style=display:flex><span>NAME           READY   STATUS    RESTARTS   AGE   IP            NODE                                    NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>pod-dra-net3   1/1     Running   0          5s    10.52.3.108   gke-dra-multi-nic-985b8c20-jg5l   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>If we execute inside the <code>Pod</code> we can see the network interface now is attached:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl exec -it pod-dra-net3 ip a
</span></span><span style=display:flex><span>kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style=display:flex><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>2: eth0@if1124: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1460 qdisc noqueue state UP group default 
</span></span><span style=display:flex><span>    link/ether 86:dc:58:24:55:1a brd ff:ff:ff:ff:ff:ff link-netnsid 0
</span></span><span style=display:flex><span>    inet 10.52.3.108/24 brd 10.52.3.255 scope global eth0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>5: eth3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 8244 qdisc fq state UP group default qlen 1000
</span></span><span style=display:flex><span>    link/ether 42:01:c0:a8:03:02 brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></div><p>Deleting the Pod restores the interface and makes it available again.</p><div class=edit-meta>Last updated on 18 Dec 2024<br>Published on 17 Dec 2024<br></div><nav class=pagination><a class="nav nav-prev" href=https://google.github.io/dranet/user/ title=Users><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - Users</a>
<a class="nav nav-next" href=https://google.github.io/dranet/contributing/ title=Contributings>Next - Contributings <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>